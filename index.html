<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Numbers â€” Tap & Learn</title>
  <style>
    :root {
      --bg: #0f172a; --card:#111827; --text:#e5e7eb; --muted:#9ca3af;
      --accent:#38bdf8; --btn:#1f2937; --btnh:#374151;
      --ok:#22c55e; --err:#ef4444;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Arial;
      background:linear-gradient(145deg,#0b1220,var(--bg)); color:var(--text);
      display:grid; min-height:100dvh; place-items:center; padding:14px;
      -webkit-user-select:none; user-select:none;
    }
    .wrap{ width:100%; max-width:700px; background:linear-gradient(180deg,#0c111b,var(--card));
      border:1px solid #1f2937; border-radius:16px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.35)}
    header{ display:flex; gap:8px; justify-content:space-between; align-items:center; padding:12px 12px 0 12px; flex-wrap:wrap}
    h1{ font-size:18px; margin:0}
    .row{ display:flex; gap:8px; flex-wrap:wrap}
    .btn,.sel{
      background:var(--btn); color:var(--text); border:1px solid #2b3544; border-radius:10px;
      padding:10px 12px; font-weight:700; cursor:pointer; transition:.15s;
    }
    .btn:active{ transform:translateY(1px) } .btn:hover{ background:var(--btnh) }
    main{ display:grid; gap:14px; padding:12px }
    .bar{ display:grid; grid-template-columns:1fr auto auto auto; gap:8px; align-items:center; color:var(--muted); font-size:14px}
    .pill{ background:#0b1220; border:1px solid #243042; padding:8px 10px; border-radius:999px; font-weight:800; color:var(--text)}
    .big{ display:grid; place-items:center; min-height:120px; background:#0b1220; border:1px dashed #2b3544; border-radius:12px}
    .big span{ font-size:clamp(56px,12vw,112px); font-weight:900; color:var(--accent); text-shadow:0 6px 40px rgba(56,189,248,.25)}
    .hint{ text-align:center; font-size:14px; color:var(--muted); margin-top:-6px}
    .pad{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; padding-bottom:12px }
    .key{
      background:linear-gradient(180deg,#0f172a,#111827);
      border:1px solid #263142;
      border-radius:12px;
      padding:18px 12px;
      font-size:clamp(22px,5vw,28px);
      font-weight:900;
      text-align:center;
      cursor:pointer;
      transition:.15s;
      color: var(--text);
      text-shadow: 0 1px 0 rgba(0,0,0,.35);
    }
    .key:active{ transform:translateY(1px) }
    .key:focus-visible{ outline:3px solid rgba(56,189,248,.6); outline-offset:2px }
    .ok{ border-color:rgba(34,197,94,.7); box-shadow:0 0 0 3px rgba(34,197,94,.15) inset; background:rgba(34,197,94,.08) }
    .bad{ border-color:rgba(239,68,68,.7); box-shadow:0 0 0 3px rgba(239,68,68,.15) inset; background:rgba(239,68,68,.08) }
    footer{ padding:8px 12px 12px; font-size:12px; color:var(--muted); text-align:center }
  </style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Numbers Tap & Learn">
    <header>
      <h1>××©×—×§ ××¡×¤×¨×™× â€” ×¨××”/×©××¢ ×•×œ×—×¥</h1>
      <div class="row">
        <button id="start" class="btn">×”×ª×—×œ</button>
        <button id="next"  class="btn">×©×œ×‘ ×”×‘×</button>
        <button id="replay" class="btn" title="×”×©××¢ ×©×•×‘">×”×©××¢ ×©×•×‘ ğŸ”</button>
        <select id="lvl" class="sel" aria-label="×¨××ª ××©×—×§">
          <option value="1">×©×œ×‘ 1: ×œ×¨××•×ª + ×œ×©××•×¢</option>
          <option value="2">×©×œ×‘ 2: ×œ×©××•×¢ ×‘×œ×‘×“</option>
        </select>
        <select id="lang" class="sel" aria-label="×©×¤×”">
          <option value="he-IL" selected>×¢×‘×¨×™×ª</option>
          <option value="en-US">English (US)</option>
          <option value="en-GB">English (UK)</option>
          <option value="es-ES">EspaÃ±ol</option>
          <option value="fr-FR">FranÃ§ais</option>
        </select>
        <button id="tts" class="btn" aria-pressed="true">ğŸ”Š ×§×•×œ: ×¤×¢×™×œ</button>
      </div>
    </header>
    <main>
      <div class="bar">
        <div class="pill">×©×œ×‘: <span id="sLvl">1</span></div>
        <div class="pill">× ×™×§×•×“: <span id="sOk">0</span>/<span id="sAll">0</span></div>
        <div class="pill">×¨×¦×£: <span id="sSt">0</span></div>
        <div class="pill" id="voiceStatus" title="×¡×˜×˜×•×¡ ×“×™×‘×•×¨">×§×•×œ: â€¦</div>
      </div>
      <div class="big"><span id="big">â€”</span></div>
      <div class="hint" id="hint">×œ×—×¥ <b>×”×ª×—×œ</b> ×›×“×™ ×œ×”×ª×—×™×œ.</div>
      <div class="pad" id="pad"></div>
    </main>
    <footer>×˜×™×¤: ×× ××™× ×š ×©×•××¢ ×¢×‘×¨×™×ª, ×•×“× ×©×§×™×™× ×§×•×œ ×¢×‘×¨×™ ×‘××¢×¨×›×ª/×“×¤×“×¤×Ÿ. ×‘××§ × ×™×ª×Ÿ ×œ×”×•×¨×™×“ ×§×•×œ×•×ª ×‘-Settings â†’ Accessibility â†’ Spoken Content.</footer>
  </div>
  <script>
  (function(){
    const $ = (q)=>document.querySelector(q);
    const start=$("#start"), next=$("#next"), replay=$("#replay"), lvl=$("#lvl"), lang=$("#lang"), tts=$("#tts");
    const sLvl=$("#sLvl"), sOk=$("#sOk"), sAll=$("#sAll"), sSt=$("#sSt");
    const big=$("#big"), pad=$("#pad"), hint=$("#hint"), voiceStatus=$("#voiceStatus");
    let cur=null, allow=false, tot=0, ok=0, st=0, ttsOn=true;

    const HE_WORDS = ["××¤×¡","××—×ª","×©×ª×™×™×","×©×œ×•×©","××¨×‘×¢","×—××©","×©×©","×©×‘×¢","×©××•× ×”","×ª×©×¢"];

    [1,2,3,4,5,6,7,8,9,'',0,''].forEach(n=>{
      const b=document.createElement('button'); b.className='key'; b.type='button';
      if(n===''){ b.disabled=true; b.style.visibility='hidden'; }
      else { b.textContent=String(n); b.setAttribute('aria-label','××¡×¤×¨ '+n); b.addEventListener('click',()=>guess(n,b)); }
      pad.appendChild(b);
    });

    let ctx=null; const getCtx=()=>ctx||(ctx=new (window.AudioContext||window.webkitAudioContext)());
    function beep(type){ const c=getCtx(), o=c.createOscillator(), g=c.createGain();
      o.type='sine'; o.frequency.value = type==='ok'?880:180; g.gain.value=0.0001;
      o.connect(g).connect(c.destination); o.start();
      const t=c.currentTime; g.gain.exponentialRampToValueAtTime(0.2,t+0.02);
      g.gain.exponentialRampToValueAtTime(0.0001,t+0.25); o.stop(t+0.28);
    }

    let voicesCache=[];
    function refreshVoices(){
      voicesCache = speechSynthesis.getVoices();
      updateVoiceStatus();
    }
    function pickVoiceForLang(langTag){
      if(!voicesCache || !voicesCache.length) return null;
      let v = voicesCache.find(v=>v.lang===langTag) || voicesCache.find(v=>v.lang && v.lang.toLowerCase().startsWith(langTag.split('-')[0].toLowerCase()));
      if(langTag.startsWith('he')){
        v = voicesCache.find(v=>/^he\b/i.test(v.lang)) || v;
      }
      return v || null;
    }
    function speak(n){
      if(!ttsOn) return;
      const langTag = lang.value || 'he-IL';
      const utter = new SpeechSynthesisUtterance();
      utter.lang = langTag;
      utter.text = langTag.startsWith('he') ? HE_WORDS[n] : String(n);
      const v = pickVoiceForLang(langTag);
      if(v) utter.voice = v;
      speechSynthesis.cancel();
      speechSynthesis.speak(utter);
      updateVoiceStatus(v);
    }
    function updateVoiceStatus(v){
      const langTag = lang.value || 'he-IL';
      const have = (voicesCache && voicesCache.length) ? (pickVoiceForLang(langTag) ? "âœ“" : "â€”") : "â€¦";
      voiceStatus.textContent = `×§×•×œ: ${have}`;
      voiceStatus.title = (v && v.name) ? `Voice: ${v.name} (${v.lang})` : (have==="â€”" ? "×œ× × ××¦× ×§×•×œ ××ª××™×. ×”×“×¤×“×¤×Ÿ ×™×©×ª××© ×‘×‘×¨×™×¨×ª ××—×“×œ." : "×˜×•×¢×Ÿ ×§×•×œ×•×ª...");
    }
    if(typeof speechSynthesis!=='undefined'){
      refreshVoices();
      speechSynthesis.onvoiceschanged = refreshVoices;
    }

    function rnd(){ return Math.floor(Math.random()*10); }
    function setLvl(){ sLvl.textContent=lvl.value; }

    function round(){
      cur=rnd(); allow=true;
      if(lvl.value==='1'){ big.textContent=String(cur); hint.textContent='×œ×—×¥ ×¢×œ ×”×¡×¤×¨×” ×”××ª××™××”.'; }
      else { big.textContent='â“'; hint.textContent='×”×§×©×‘ ×•×œ×—×¥ ×¢×œ ×”×¡×¤×¨×” ×”× ×›×•× ×”.'; }
      speak(cur);
      document.querySelectorAll('.key').forEach(k=>k.classList.remove('ok','bad'));
    }

    function guess(n, el){
      if(!allow||cur===null) return;
      tot++; sAll.textContent=tot;
      if(n===cur){ ok++; st++; el.classList.add('ok'); beep('ok'); }
      else { st=0; el.classList.add('bad'); beep('bad');
        const c=[...document.querySelectorAll('.key')].find(b=>b.textContent===String(cur));
        if(c){ c.classList.add('ok'); setTimeout(()=>c.classList.remove('ok'), 450); }
      }
      sOk.textContent=ok; sSt.textContent=st; allow=false; setTimeout(round, 650);
    }

    start.addEventListener('click',()=>{ tot=ok=st=0; sAll.textContent=sOk.textContent=sSt.textContent='0'; setLvl(); hint.textContent='!×”××©×—×§ ×”×ª×—×™×œ'; round(); });
    next.addEventListener('click',()=>{ lvl.value = (lvl.value==='1')?'2':'1'; setLvl(); if(cur!==null) round(); });
    replay.addEventListener('click',()=>{ if(cur!==null) speak(cur); });
    lvl.addEventListener('change',()=>{ setLvl(); if(cur!==null) round(); });
    lang.addEventListener('change',()=>{ if(cur!==null) speak(cur); updateVoiceStatus(); });
    tts.addEventListener('click',()=>{ ttsOn=!ttsOn; tts.textContent= ttsOn?'ğŸ”Š ×§×•×œ: ×¤×¢×™×œ':'ğŸ”‡ ×§×•×œ: ×›×‘×•×™'; tts.setAttribute('aria-pressed', String(ttsOn)); });
  })();
  </script>
</body>
</html>
